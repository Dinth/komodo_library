services:
  ebusd:
    container_name: ebusd
    hostname: ebusd
    image: john30/ebusd:v26.1
    ipc: private
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    environment:
      EBUSD_MQTTINT: "/etc/ebusd/mqtt-hassio.cfg"
      EBUSD_MQTTJSON: "true"
      EBUSD_FOREGROUND: ""
      EBUSD_MQTTHOST: "10.10.1.11"
      EBUSD_MQTTPORT: "1883"
      EBUSD_MQTTCLIENTID: "ebusd"
      EBUSD_MQTTVAR: "filter-direction=r|u|^w"
      EBUSD_MQTTLOG: ""
      EBUSD_ACCESSLEVEL: "*"
      EBUSD_SCANCONFIG: ""
      EBUSD_DEVICE: "ens:10.10.25.8:9999"
      EBUSD_MQTTUSER: "${EBUSD_MQTTUSER}"
      EBUSD_MQTTPASS: "${EBUSD_MQTTPASS}"
    labels:
      repliqate.enabled: 'true'
      repliqate.engine: "restic"
      repliqate.schedule: "@monthly 3am"
      repliqate.backup_id: ebusd
      repliqate.retention: "365d"
      wud.watch: "true"
      wud.display.icon: "sh-ebusd"
      wud.display.name: "Ebusd"
      wud.tag.include: '^v\d+\.\d$'
      wud.link.template: "https://github.com/john30/ebusd/releases/tag/v$${major}.$${minor}"
    deploy:
      resources:
        limits:
          memory: 128M
          cpus: '0.50'
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    healthcheck:
      test: ["CMD", "ebusctl", "info"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - ebusd
#    ports:
#      - 8888:8888/tcp
    restart: unless-stopped
    volumes:
      - /opt/docker/ebusd/ebusd_data:/etc/ebusd
networks:
  ebusd:
    name: ebusd
    driver: bridge
    external: false
